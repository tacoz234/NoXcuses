<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoXcuses - Current Workout</title>
    <!-- Add this inside <head> in both files -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Dark background similar to the app theme */
            color: #ffffff; /* White text for contrast */
            padding-bottom: 1rem; /* Small padding at bottom */
        }

        /* Custom styles for the three-dot menu */
        .three-dots::after {
            content: "\2022\2022\2022"; /* Three middle dots */
            display: inline-block;
            font-size: 1.2em;
            line-height: 0.5em;
            vertical-align: middle;
            letter-spacing: 0.1em;
            color: #888; /* Gray color for the dots */
        }

        /* Custom styling for the rest timer and workout timer */
        .timer-button {
            background-color: rgba(255, 255, 255, 0.1); /* Slightly transparent white for a subtle look */
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px); /* Frosted glass effect */
        }

        .exercise-card {
    position: relative;
}
.exercise-card .delete-exercise-btn {
    right: 0;
    top: 0;
    height: 100%;
    width: 80px;
    border-radius: 0 0.5rem 0.5rem 0;
    transform: translateX(100%);
    transition: transform 0.2s;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
}
.exercise-card.swiped .delete-exercise-btn {
    transform: translateX(0);
}
.exercise-card .exercise-content {
    transition: transform 0.2s;
}

/* Add to your <style> */
.set-row {
    position: relative;
}
.set-row .delete-set-btn {
    right: 0;
    top: 0;
    height: 100%;
    width: 64px;
    border-radius: 0 0.5rem 0.5rem 0;
    transform: translateX(100%);
    transition: transform 0.2s;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
}
.set-row.swiped .delete-set-btn {
    transform: translateX(0);
}
.set-row .set-content {
    transition: transform 0.2s;
}
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased">

    <!-- Header Section for Workout Tracking -->
    <header class="w-full p-4 fixed top-0 z-10 flex justify-between items-center bg-gray-900 shadow-lg">
        <!-- Rest Timer Button (Top Left) -->
        <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-full text-sm shadow-md transition-colors duration-300 timer-button">
            Rest Timer
        </button>

        <!-- Workout Duration Counter (Top Middle) -->
        <div id="workout-duration" class="text-white text-lg font-bold timer-button px-4 py-2 rounded-full">
            00:00:00
        </div>

        <!-- Finish Workout Button (Top Right) -->
        <button class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-full text-sm shadow-md transition-colors duration-300">
            Finish
        </button>
    </header>

    <!-- Main Content Section -->
    <main class="flex-grow container mx-auto p-4 pt-24 md:pt-28 lg:pt-32">

        <!-- Exercises Section (initially empty) -->
        <section id="exercises-container" class="space-y-4">
            <!-- No exercise cards here initially -->
        </section>

        <!-- Add Exercise Button -->
        <button id="add-exercise-btn" class="w-full mt-6 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-md shadow-md transition-colors duration-300 text-lg">
            Add Exercise
        </button>

    </main>

    <script>
        let workoutStartTime;
        let workoutInterval;
        let restTimerInterval;
        let restTimeRemaining = 0;

        const workoutDurationDisplay = document.getElementById('workout-duration');
        const restTimerButton = document.querySelector('button.bg-blue-600');
        const addExerciseButton = document.getElementById('add-exercise-btn');
        const exercisesContainer = document.getElementById('exercises-container');

        // Function to format time as HH:MM:SS
        function formatTime(totalSeconds) {
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        // Start workout timer
        function startWorkoutTimer() {
            workoutStartTime = Date.now();
            workoutInterval = setInterval(() => {
                const elapsedSeconds = Math.floor((Date.now() - workoutStartTime) / 1000);
                workoutDurationDisplay.textContent = formatTime(elapsedSeconds);
            }, 1000);
        }

        // Rest Timer functionality (simple toggle for now)
        function toggleRestTimer() {
            if (restTimerInterval) {
                // Timer is running, stop it
                clearInterval(restTimerInterval);
                restTimerInterval = null;
                restTimerButton.textContent = 'Rest Timer';
                restTimeRemaining = 0; // Reset
            } else {
                // Start a 60-second rest timer (example)
                restTimeRemaining = 60;
                restTimerButton.textContent = `Rest: ${formatTime(restTimeRemaining)}`;
                restTimerInterval = setInterval(() => {
                    restTimeRemaining--;
                    restTimerButton.textContent = `Rest: ${formatTime(restTimeRemaining)}`;
                    if (restTimeRemaining <= 0) {
                        clearInterval(restTimerInterval);
                        restTimerInterval = null;
                        restTimerButton.textContent = 'Rest Timer (Done!)';
                        // Optionally play a sound or vibrate
                    }
                }, 1000);
            }
        }

        // Function to add a new exercise card
        function addExerciseCard(name, sets, rest) {
            if (typeof name !== 'string') {
                name = '';
            }
            let setsHtml = '';
            if (Array.isArray(sets) && sets.length > 0) {
                sets.forEach((set, idx) => {
                    setsHtml += `
                        <div class="set-row relative flex items-center space-x-2 bg-white rounded-md overflow-hidden group">
                            <button class="delete-set-btn absolute top-0 right-0 h-full w-16 bg-red-600 text-white font-bold rounded-md transition-all duration-200 translate-x-full z-10">Delete</button>
                            <div class="set-content flex items-center space-x-2 w-full transition-transform duration-200">
                                <span class="font-medium text-gray-600">Set ${idx + 1}</span>
                                <input type="number" placeholder="Weight (kg/lbs)" value="${set.weight || ''}" class="flex-1 p-2 border rounded-md text-sm text-gray-800 bg-gray-100">
                                <input type="number" placeholder="Reps" value="${set.reps || ''}" class="w-20 p-2 border rounded-md text-sm text-gray-800 bg-gray-100">
                                <input type="checkbox" class="h-5 w-5 text-blue-600 rounded-md" ${set.completed ? 'checked' : ''}>
                            </div>
                        </div>
                    `;
                    // Add rest row after each set except the last
                    if (rest && idx < sets.length - 1) {
                        setsHtml += `
                            <div class="rest-row flex items-center justify-center text-xs text-blue-500 my-1">
                                Rest: ${rest}
                            </div>
                        `;
                    }
                });
            }
            // Show number of sets before the name, and prevent name cutoff
            const setCount = Array.isArray(sets) ? sets.length : 0;
            const newExerciseHtml = `
                <div class="exercise-card relative bg-white p-4 rounded-lg shadow-md text-gray-900 overflow-hidden group">
                    <button class="delete-exercise-btn absolute top-0 right-0 h-full w-20 bg-red-600 text-white font-bold rounded-lg transition-all duration-200 translate-x-full z-10 hidden">Delete</button>
                    <div class="exercise-content transition-transform duration-200">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center w-full gap-2">
                                <span class="font-bold text-blue-600">${setCount > 0 ? setCount : ''}</span>
                                <span class="flex-1 text-lg font-semibold p-1 border-b border-gray-300 bg-transparent focus:outline-none whitespace-normal break-words" style="word-break:break-word;min-width:0;">${name}</span>
                            </div>
                            <button class="three-dots cursor-pointer bg-transparent border-0 text-xl ml-2" title="More"></button>
                            <div class="exercise-menu absolute right-0 top-10 bg-white rounded shadow-lg z-20 hidden min-w-[140px]">
                                <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600 delete-exercise-menu">Delete</button>
                                <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 replace-exercise-menu">Replace Exercise</button>
                                <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 cancel-exercise-menu">Cancel</button>
                            </div>
                        </div>
                        <div class="sets-container space-y-2">
                            ${setsHtml}
                        </div>
                        <button class="w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-md text-sm transition-colors duration-300 add-set-btn">
                            Add Set
                        </button>
                    </div>
                </div>
            `;
            exercisesContainer.insertAdjacentHTML('beforeend', newExerciseHtml);
            const newCard = exercisesContainer.lastElementChild;
            attachAddSetListeners();
            // attachExerciseSwipeListener(newCard); // REMOVE THIS LINE
            attachThreeDotsMenu(newCard);
        }

        // Attach three-dots menu logic
        function attachThreeDotsMenu(card) {
            const dotsBtn = card.querySelector('.three-dots');
            const menu = card.querySelector('.exercise-menu');
            // Remove any previous click handler
            dotsBtn.onclick = null;
            dotsBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                // Hide all other menus
                document.querySelectorAll('.exercise-menu').forEach(m => m.classList.add('hidden'));
                menu.classList.toggle('hidden');
            });
            // Hide menu on click outside
            document.addEventListener('click', function hideMenu(e) {
                if (!card.contains(e.target)) menu.classList.add('hidden');
            });
            // Menu actions
            menu.querySelector('.delete-exercise-menu').onclick = (e) => {
                e.stopPropagation();
                card.remove();
            };
            menu.querySelector('.replace-exercise-menu').onclick = (e) => {
                e.stopPropagation();
                alert('Replace Exercise (not implemented)');
                menu.classList.add('hidden');
            };
            menu.querySelector('.cancel-exercise-menu').onclick = (e) => {
                e.stopPropagation();
                menu.classList.add('hidden');
            };
        }

        // Function to add a new set to an exercise
        function addSetToExercise(button) {
            const setsContainer = button.previousElementSibling; // This is the sets-container div
            const currentSetCount = setsContainer.children.length + 1;
            const newSetHtml = `
                <div class="set-row relative flex items-center space-x-2 bg-white rounded-md overflow-hidden group">
                    <button class="delete-set-btn absolute top-0 right-0 h-full w-16 bg-red-600 text-white font-bold rounded-md transition-all duration-200 translate-x-full z-10 hidden">Delete</button>
                    <div class="set-content flex items-center space-x-2 w-full transition-transform duration-200">
                        <span class="font-medium text-gray-600">Set ${currentSetCount}</span>
                        <input type="number" placeholder="Weight (kg/lbs)" class="flex-1 p-2 border rounded-md text-sm text-gray-800 bg-gray-100">
                        <input type="number" placeholder="Reps" class="w-20 p-2 border rounded-md text-sm text-gray-800 bg-gray-100">
                        <input type="checkbox" class="h-5 w-5 text-blue-600 rounded-md">
                    </div>
                </div>
            `;
            setsContainer.insertAdjacentHTML('beforeend', newSetHtml);
            const newSetRow = setsContainer.lastElementChild;
            newSetRow.classList.remove('swiped');
            newSetRow.querySelector('.set-content').style.transform = '';
            attachSetSwipeListener(newSetRow);
            setsContainer.lastElementChild.classList.remove('swiped'); // Ensure delete button is hidden
        }

        // Attach event listeners for dynamically added "Add Set" buttons
        function attachAddSetListeners() {
            document.querySelectorAll('.add-set-btn').forEach(button => {
                button.onclick = () => addSetToExercise(button);
            });
        }

        // Add this function to gather workout data and save to localStorage
        function finishWorkout() {
            clearInterval(workoutInterval);

            // Gather workout duration
            const duration = workoutDurationDisplay.textContent;

            // Gather exercises and sets
            const exercises = [];
            document.querySelectorAll('#exercises-container > div').forEach(exDiv => {
                let nameInput = exDiv.querySelector('input[type="text"], h3');
                let exerciseName = nameInput ? (nameInput.value || nameInput.textContent) : 'Exercise';
                let sets = [];
                exDiv.querySelectorAll('.sets-container > div, .space-y-2 > div').forEach(setDiv => {
                    const inputs = setDiv.querySelectorAll('input');
                    if (inputs.length >= 3) {
                        sets.push({
                            weight: inputs[0].value,
                            reps: inputs[1].value,
                            completed: inputs[2].checked
                        });
                    }
                });
                if (sets.length > 0) {
                    exercises.push({ name: exerciseName, sets });
                }
            });

            // Prepare workout object
            const workout = {
                date: new Date().toISOString(),
                duration,
                exercises
            };

            // Save to localStorage
            const history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
            history.push(workout);
            localStorage.setItem('workoutHistory', JSON.stringify(history));

            // Redirect to history page
            window.location.href = 'history.html';
        }

        // Initial setup on page load
        window.onload = function() {
            // Check for a selected template in localStorage
            const selectedTemplate = localStorage.getItem('selectedTemplate');
            if (selectedTemplate) {
                try {
                    const template = JSON.parse(selectedTemplate);
                    exercisesContainer.innerHTML = '';
                    template.exercises.forEach(ex => {
                        // Fill sets array based on working_sets and reps from template
                        let sets = [];
                        let reps = ex.reps || '';
                        let workingSets = parseInt(ex.working_sets) || 0;
                        for (let i = 0; i < workingSets; i++) {
                            sets.push({ weight: '', reps: reps, completed: false });
                        }
                        addExerciseCard(ex.name, sets, ex.rest);
                    });
                    // Optionally clear the selected template after loading
                    // localStorage.removeItem('selectedTemplate');
                } catch (e) {
                    // If parsing fails, ignore and start empty
                }
            }
            startWorkoutTimer();
            restTimerButton.addEventListener('click', toggleRestTimer);
            attachAddSetListeners();
            const finishBtn = document.querySelector('header button.bg-red-600');
            if (finishBtn) {
                finishBtn.addEventListener('click', finishWorkout);
            }
        };
    </script>
<!-- Consistent Bottom Navbar for all pages -->
<nav class="fixed bottom-0 left-0 w-full bg-gray-800 border-t border-gray-700 shadow-lg md:hidden z-50">
    <ul class="flex justify-around items-center h-16">
        <li class="flex-1">
            <a href="index.html" class="flex flex-col items-center justify-center transition-colors duration-300 p-2
                HOME_ACTIVE
                text-blue-500 hover:text-blue-400">
                <i class="fas fa-home text-xl"></i>
                <span class="text-xs mt-1">Home</span>
            </a>
        </li>
        <li class="flex-1">
            <a href="history.html" class="flex flex-col items-center justify-center transition-colors duration-300 p-2
                HISTORY_ACTIVE
                text-blue-500 hover:text-blue-400">
                <i class="fas fa-history text-xl"></i>
                <span class="text-xs mt-1">History</span>
            </a>
        </li>
        <li class="flex-1">
            <a href="workout.html" class="flex flex-col items-center justify-center transition-colors duration-300 p-2
                WORKOUT_ACTIVE
                text-blue-500 hover:text-blue-400">
                <i class="fas fa-plus-circle text-3xl"></i>
                <span class="text-xs mt-1">Start</span>
            </a>
        </li>
        <li class="flex-1">
            <a href="exercises.html" class="flex flex-col items-center justify-center transition-colors duration-300 p-2
                EXERCISES_ACTIVE
                text-blue-500 hover:text-blue-400">
                <i class="fas fa-dumbbell text-xl"></i>
                <span class="text-xs mt-1">Exercises</span>
            </a>
        </li>
    </ul>
</nav>
<script>
// Navbar highlight logic
(function() {
    const path = window.location.pathname;
    const nav = document.querySelector('nav');
    if (!nav) return;
    let page = '';
    if (path.endsWith('index.html')) page = 'HOME';
    else if (path.endsWith('history.html')) page = 'HISTORY';
    else if (path.endsWith('workout.html')) page = 'WORKOUT';
    else if (path.endsWith('exercises.html')) page = 'EXERCISES';
    nav.innerHTML = nav.innerHTML
        .replace('HOME_ACTIVE', page==='HOME' ? 'text-blue-500' : 'text-gray-400')
        .replace('HISTORY_ACTIVE', page==='HISTORY' ? 'text-blue-500' : 'text-gray-400')
        .replace('WORKOUT_ACTIVE', page==='WORKOUT' ? 'text-blue-500' : 'text-gray-400')
        .replace('EXERCISES_ACTIVE', page==='EXERCISES' ? 'text-blue-500' : 'text-gray-400');
})();
</script>
<!-- Exercise Search Modal -->
<div id="exercise-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 text-gray-900 relative">
        <button id="close-exercise-modal" class="absolute top-2 right-3 text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
        <h2 class="text-xl font-semibold mb-4">Add Exercise</h2>
        <input id="exercise-search" type="text" placeholder="Search exercises..." class="w-full mb-4 p-2 border rounded" />
        <div id="exercise-list" class="max-h-64 overflow-y-auto space-y-2"></div>
    </div>
</div>
<script>
let allExercises = [];

// Show modal on Add Exercise click
document.getElementById('add-exercise-btn').onclick = function() {
    document.getElementById('exercise-modal').classList.remove('hidden');
    document.getElementById('exercise-search').value = '';
    renderExerciseList('');
};

// Close modal
document.getElementById('close-exercise-modal').onclick = function() {
    document.getElementById('exercise-modal').classList.add('hidden');
};

// Fetch exercises from JSON
fetch('exercises.json')
    .then(res => res.json())
    .then(data => {
        allExercises = data;
        renderExerciseList('');
    });

function renderExerciseList(filter) {
    const list = document.getElementById('exercise-list');
    list.innerHTML = '';
    const filtered = allExercises.filter(ex => ex.name.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(ex => {
        const btn = document.createElement('button');
        btn.className = 'w-full text-left p-2 rounded hover:bg-blue-100';
        btn.textContent = ex.name;
        btn.onclick = function() {
            // Use main addExerciseCard with default set/rest
            addExerciseCard(ex.name, [{weight: '', reps: '', completed: false}], '60s');
            document.getElementById('exercise-modal').classList.add('hidden');
        };
        list.appendChild(btn);
    });
}

// Filter as you type
document.getElementById('exercise-search').oninput = function(e) {
    renderExerciseList(e.target.value);
};

// Update addExerciseCard to accept a name
function addExerciseCard(name) {
    if (typeof name !== 'string') {
        name = '';
    }
    const newExerciseHtml = `
        <div class="exercise-card relative bg-white p-4 rounded-lg shadow-md text-gray-900 overflow-hidden group">
            <button class="delete-exercise-btn absolute top-0 right-0 h-full w-20 bg-red-600 text-white font-bold rounded-lg transition-all duration-200 translate-x-full z-10 hidden">Delete</button>
            <div class="exercise-content transition-transform duration-200">
                <div class="flex justify-between items-center mb-3">
                    <input type="text" value="${name}" placeholder="Exercise Name" class="flex-1 text-lg font-semibold p-1 border-b border-gray-300 bg-transparent focus:outline-none truncate">
                    <button class="three-dots cursor-pointer bg-transparent border-0 text-xl" title="Delete Exercise"></button>
                </div>
                <div class="sets-container space-y-2">
                    <!-- Sets will be added here -->
                </div>
                <button class="w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-md text-sm transition-colors duration-300 add-set-btn">
                    Add Set
                </button>
            </div>
        </div>
    `;
    // Insert and get the new card element
    exercisesContainer.insertAdjacentHTML('beforeend', newExerciseHtml);
    const newCard = exercisesContainer.lastElementChild;
    attachAddSetListeners();
    attachExerciseSwipeListener(newCard); // Only for the new card

    // Attach delete to three-dots button
    const dotsBtn = newCard.querySelector('.three-dots');
    dotsBtn.onclick = () => newCard.remove();
}

// Exercise swipe listeners for delete functionality
function attachExerciseSwipeListener(card) {
    const content = card.querySelector('.exercise-content');
    const deleteBtn = card.querySelector('.delete-exercise-btn');
    let startX = 0, currentX = 0, swiped = false;

    // Touch events for mobile
    content.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
        content.style.transition = '';
    });
    content.addEventListener('touchmove', function(e) {
        currentX = e.touches[0].clientX;
        let dx = currentX - startX;
        if (swiped && dx > 0) {
            content.style.transform = `translateX(${dx - 80}px)`;
        } else if (!swiped) {
            content.style.transform = `translateX(${dx}px)`;
        }
    });
    content.addEventListener('touchend', function(e) {
        let dx = currentX - startX;
        content.style.transition = 'transform 0.2s';
        if (!swiped && dx < -60) {
            content.style.transform = 'translateX(-80px)';
            card.classList.add('swiped');
            swiped = true;
        } else if (swiped && dx > 40) {
            content.style.transform = '';
            card.classList.remove('swiped');
            swiped = false;
        } else if (swiped) {
            content.style.transform = 'translateX(-80px)';
            card.classList.add('swiped');
        } else {
            content.style.transform = '';
            card.classList.remove('swiped');
            swiped = false;
        }
        startX = 0; currentX = 0;
    });

    // Mouse events for desktop
    let mouseDown = false, mouseStartX = 0, mouseCurrentX = 0;
    content.addEventListener('mousedown', function(e) {
        mouseDown = true;
        mouseStartX = e.clientX;
        content.style.transition = '';
    });
    content.addEventListener('mousemove', function(e) {
        if (!mouseDown) return;
        mouseCurrentX = e.clientX;
        let dx = mouseCurrentX - mouseStartX;
        if (swiped && dx > 0) {
            content.style.transform = `translateX(${dx - 80}px)`;
        } else if (!swiped) {
            content.style.transform = `translateX(${dx}px)`;
        }
    });
    content.addEventListener('mouseup', function(e) {
        if (!mouseDown) return;
        let dx = mouseCurrentX - mouseStartX;
        content.style.transition = 'transform 0.2s';
        if (!swiped && dx < -60) {
            content.style.transform = 'translateX(-80px)';
            card.classList.add('swiped');
            swiped = true;
        } else if (swiped && dx > 40) {
            content.style.transform = '';
            card.classList.remove('swiped');
            swiped = false;
        } else if (swiped) {
            content.style.transform = 'translateX(-80px)';
            card.classList.add('swiped');
        } else {
            content.style.transform = '';
            card.classList.remove('swiped');
            swiped = false;
        }
        mouseDown = false;
        mouseStartX = 0; mouseCurrentX = 0;
    });
    content.addEventListener('mouseleave', function(e) {
        if (mouseDown) {
            content.dispatchEvent(new MouseEvent('mouseup'));
        }
    });

    // Delete button click
    deleteBtn.onclick = function() {
        card.remove();
    };
}

// Update attachSetSwipeListener with the new code
function attachSetSwipeListener(setRow) {
    const content = setRow.querySelector('.set-content');
    const deleteBtn = setRow.querySelector('.delete-set-btn');
    let startX = 0, currentX = 0, swiped = false;

    // Touch events
    content.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
        content.style.transition = '';
    });
    content.addEventListener('touchmove', function(e) {
        currentX = e.touches[0].clientX;
        let dx = currentX - startX;
        if (swiped && dx > 0) {
            content.style.transform = `translateX(${dx - 64}px)`;
        } else if (!swiped) {
            content.style.transform = `translateX(${dx}px)`;
        }
    });
    content.addEventListener('touchend', function(e) {
        let dx = currentX - startX;
        content.style.transition = 'transform 0.2s';
        if (!swiped && dx < -40) {
            content.style.transform = 'translateX(-64px)';
            setRow.classList.add('swiped');
            swiped = true;
        } else if (swiped && dx > 30) {
            content.style.transform = '';
            setRow.classList.remove('swiped');
            swiped = false;
        } else if (swiped) {
            content.style.transform = 'translateX(-64px)';
            setRow.classList.add('swiped');
        } else {
            content.style.transform = '';
            setRow.classList.remove('swiped');
            swiped = false;
        }
        startX = 0; currentX = 0;
    });

    // Mouse events
    let mouseDown = false, mouseStartX = 0, mouseCurrentX = 0;
    content.addEventListener('mousedown', function(e) {
        mouseDown = true;
        mouseStartX = e.clientX;
        content.style.transition = '';
    });
    content.addEventListener('mousemove', function(e) {
        if (!mouseDown) return;
        mouseCurrentX = e.clientX;
        let dx = mouseCurrentX - mouseStartX;
        if (swiped && dx > 0) {
            content.style.transform = `translateX(${dx - 64}px)`;
        } else if (!swiped) {
            content.style.transform = `translateX(${dx}px)`;
        }
    });
    content.addEventListener('mouseup', function(e) {
        if (!mouseDown) return;
        let dx = mouseCurrentX - mouseStartX;
        content.style.transition = 'transform 0.2s';
        if (!swiped && dx < -40) {
            content.style.transform = 'translateX(-64px)';
            setRow.classList.add('swiped');
            swiped = true;
        } else if (swiped && dx > 30) {
            content.style.transform = '';
            setRow.classList.remove('swiped');
            swiped = false;
        } else if (swiped) {
            content.style.transform = 'translateX(-64px)';
            setRow.classList.add('swiped');
        } else {
            content.style.transform = '';
            setRow.classList.remove('swiped');
            swiped = false;
        }
        mouseDown = false;
        mouseStartX = 0; mouseCurrentX = 0;
    });
    content.addEventListener('mouseleave', function(e) {
        if (mouseDown) {
            content.dispatchEvent(new MouseEvent('mouseup'));
        }
    });

    // Delete button click
    deleteBtn.onclick = function() {
        setRow.remove();
    };
}
</script>
</body>
</html>
